rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Deny everything else by default
    match /{document=**} {
      allow read, write: if false;
    }

    // Categories can be read by anyone, but only written by staff/admins
    match /categories/{categoryId} {
      allow read:  if true;
      allow write: if isStaff() || isAdmin();
    }

    // Menu items can be read by anyone, but only written by staff/admins
    match /menu-items/{itemId} {
      allow read:  if true;
      allow write: if isStaff() || isAdmin();
    }

    // Orders can be created and read by anyone (for public invoices),
    // but only staff can list them, and only admins can modify/delete them.
    match /orders/{orderId} {
      allow get, create: if true;
      allow list, update, delete: if request.auth != null && (isAdmin() || isStaff());
    }
    
    // Brand Asset can be read by anyone, written by staff/admins
    match /'Brand Asset'/{assetId} {
      allow read: if true;
      write: if request.auth != null && (isAdmin() || isStaff());
    }

    function isStaff() {
      // This checks if a user is logged in and has a 'role' custom claim of 'staff'.
      return request.auth != null && request.auth.token.role == 'staff';
    }

    function isAdmin() {
      // This checks if a user is logged in and has a 'role' custom claim of 'admin'.
      return request.auth != null && request.auth.token.role == 'admin';
    }
  }
}
