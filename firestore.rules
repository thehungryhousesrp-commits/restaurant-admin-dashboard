rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Helper Functions for Role Checking ---

    // The Admin has full control.
    function isAdmin() {
      return request.auth.uid == '8kkXdYsoX5MsRlv371w1e6i8qQh2';
    }

    // The Staff can manage orders but cannot delete them or edit the menu.
    function isStaff() {
      return request.auth.uid == 'Z4DG5kCaE8agIRGGwT4ML4u3J9K2';
    }

    // --- Public & Admin/Staff Read Rules ---

    // Menu items can be read by anyone.
    // Only Admins can create, update, or delete menu items.
    match /menu-items/{itemId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Categories can be read by anyone.
    // Only Admins can create, update, or delete categories.
    match /categories/{categoryId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // --- Order & Invoice Rules ---

    match /orders/{orderId} {
      // Any authenticated user (Admin or Staff) can create a new order.
      allow create: if request.auth != null;
      
      // Anyone with a direct link can view a single invoice (for public invoice pages).
      allow get: if true; 

      // Staff can read and update orders (e.g., change status), but cannot delete them.
      allow list, read, update: if isStaff() || isAdmin();
      
      // Only the Admin can delete an order record.
      allow delete: if isAdmin();
    }

    // --- User Data Rules (Not currently used, but good for future) ---

    // Users can read their own data. Admins can read/write any user's data.
    match /users/{userId} {
      allow read, write: if isAdmin() || request.auth.uid == userId;
    }
  }
}
